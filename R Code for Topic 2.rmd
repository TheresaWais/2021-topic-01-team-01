```{r}
# Correaltion between applied drugs and cytotoxic effect on lung cancer cells?

## Can we separate lung cancer subtypes by Principal Components

  ## filter prism data for lung cancer cell lines
diseases=prism.cl[, 20]

p_lung=c(which(diseases=="Lung Cancer"))


prism_lung=prism[p_lung,]
prism_lung

# prism data set which only contains lung cancer cell lines:     prism_lung

# check for number of lung cancer cell lines
dim(prism_lung)
```

```{r}
# Principal Component analysis with lung cancer cell lines from prism data set

  ## PCA makes Z-transformation necessary (whithin columns)

prism_lung_scaled=scale(prism_lung)

# compute variance for all medicaments accross all cell lines
topVar=apply(prism_lung, 1, var, na.rm=TRUE)
summary(topVar)

# only select those medicaments and their doses which explain a variance in the top 25%
q75=quantile(topVar, probs=0.75)
lung.top.Var=prism_lung[which(topVar>=q75),]
dim(lung.top.Var)
```
```{r}
## correlation based distance matric
cor.mat=cor(lung.top.Var, method="pearson")
library (pheatmap)
pheatmap(cor.mat)
```




```{r}
# search for NAs in prism_lung

sum(is.na(prism_lung))
```
```{r}
install.packages("VIM")
library(VIM)
```


```{r}
sleep[!complete.cases((VIM::sleep),)]
sum(is.na(VIM::sleep))
```

```{r}
###??????????????????????????????
nPCs=estim_ncpPCA(prism_lung, ncp.min=0, ncp.max=100, method="Regularized", scale=TRUE, method.cv="gcv")
nPCs$ncp

completed=imputePCA(prism_lung, ncp=nPCs$ncp, scale=TRUE)
```

```{r}
# question for tutorium

# use library(missMDA)
library(VIM)
library(missMDA)
## only use first 20 columns
ncp=estim_ncpPCA(prism_lung[,1:500])
complete=imputePCA(prism_lung[,1:500], ncp=ncp$ncp, scale=TRUE)
complete
```


```{r}
# run PCA
library(FactoMineR)
lung_pca=PCA(complete$completeObs)
```


```{r}
# compute variance of eigenvalues
lung_pca$eig

lung_pca$var$cos2
```


```{r}
lung_pca$var$contrib
```
```{r}
dimdesc(lung_pca)
```
```{r}
# install.packages("devtools")
library("devtools")
install_github("kassambara/factoextra")


library("factoextra")
fviz_pca_var(lung_pca, col.var="contrib", repel=TRUE)
```
```{r}
# get eigenvalues bigger than 1
summary(lung_pca)
lung_pca$eig
get_eigenvalue(lung_pca)
```
```{r}
# 
library(paran)
paran(lung_pca, graph=TRUE)
```


```{r}
# run PCA with prcomp()
prcomp(complete)


```


```{r}
estim_ncpPCA(prism_lung)
```

```{r}
# imupting missing values with pcaMethods
# library(pcaMethods)
##-> not possible with this version of r!
imputePCA(prism_lung, scale=TRUE, )
```

```{r}
# use prcomp for PCA
prcomp(prism_lung, na.rm)
```
```{r}
# use hotdeck() for imputing missing data
prism_lung_imputed=hot.deck(prism_lung)


```
```{r}
install.packages("pcaMethods")

```
```{r}
chooseCRANmirror()
```

```{r}
kNN(prism_lung)
```

